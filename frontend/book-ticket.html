<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Book Train Ticket | Railway Support Ticket System</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:"Segoe UI",sans-serif;}
body{
  background:linear-gradient(to right,#0f2027,#203a43,#2c5364);
  color:white;display:flex;justify-content:center;align-items:flex-start;
  min-height:100vh;padding-top:20px;
}
.card{
  width:440px;background:#1e1e1e;padding:20px;border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,0.4);overflow-y:auto;max-height:90vh;
}
.header{display:flex;align-items:center;justify-content:space-between;}
.header button{
  background:none;border:none;color:#4fc3f7;font-size:18px;cursor:pointer;
}
.train-info{
  background:#2a2a2a;padding:12px;border-radius:10px;margin:15px 0;text-align:center;
}
h3{color:#4fc3f7;margin-bottom:10px;text-align:center;}
form label{display:block;margin-top:8px;font-size:14px;}
form input,select{
  width:100%;padding:10px;margin-top:4px;border:none;border-radius:6px;
  background:#333;color:white;font-size:14px;
}
.submit-btn{
  width:100%;margin-top:15px;padding:10px;border:none;border-radius:8px;
  background:#4caf50;color:white;font-size:15px;cursor:pointer;
}
.submit-btn:hover{background:#3b8d3b;}
</style>
</head>
<body>
<div class="card">
  <div class="header">
    <button onclick="goBack()">‚Üê Back</button>
    <h3>Book Ticket</h3>
  </div>

  <div id="trainInfo" class="train-info"></div>

  <form id="bookingForm">
    <label>Passenger Name</label>
    <input type="text" id="name" placeholder="Enter passenger name" required>

    <label>Age</label>
    <input type="number" id="age" placeholder="Enter age" required min="1">

    <label>Gender</label>
    <select id="gender" required>
      <option value="">Select Gender</option>
      <option>Male</option>
      <option>Female</option>
      <option>Other</option>
    </select>

    <label>Berth Preference</label>
    <select id="berth" required>
      <option value="">Select Berth</option>
      <option>Lower</option>
      <option>Middle</option>
      <option>Upper</option>
      <option>Side Lower</option>
      <option>Side Upper</option>
    </select>

    <label>No. of Passengers</label>
    <input type="number" id="passengers" placeholder="e.g. 1, 2, 3" min="1" max="6" required>

    <button type="submit" class="submit-btn">‚úÖ Confirm Booking</button>
  </form>
</div>

<script>
function goBack(){ window.location.href = "train list.html"; }

const train = JSON.parse(localStorage.getItem("selectedTrain"));
const search = JSON.parse(localStorage.getItem("searchData"));

if(!train || !search){
  alert("Missing train or search details. Please search again.");
  window.location.href = "search train.html";
}

// Display train details
document.getElementById("trainInfo").innerHTML = `
  <h4>${train.name} (${train.no})</h4>
  <p>${search.from.name} ‚ûú ${search.to.name}</p>
  <p><b>Departure:</b> ${formatTime(train.depart)} | <b>Arrival:</b> ${formatTime(train.arrive)}</p>
  <p>üìÖ <b>Date:</b> ${search.date}</p>
`;

document.getElementById("bookingForm").addEventListener("submit",(e)=>{
  e.preventDefault();

  const booking = {
    train,
    date: search.date,
    from: search.from.name,
    to: search.to.name,
    passengerName: document.getElementById("name").value,
    age: document.getElementById("age").value,
    gender: document.getElementById("gender").value,
    berth: document.getElementById("berth").value,
    count: document.getElementById("passengers").value,
    pnr: generatePNR(),
    seat: "S" + Math.floor(Math.random() * 80 + 1),
  };

  localStorage.setItem("bookingDetails", JSON.stringify(booking));
  window.location.href = "confirm ticket.html";
});

function generatePNR(){
  return Math.floor(1000000000 + Math.random()*9000000000);
}

function formatTime(t){
  let [h,m] = t.split(":").map(Number);
  const ampm = h >= 12 ? "PM" : "AM";
  h = h % 12 || 12;
  return `${h}:${m.toString().padStart(2,"0")} ${ampm}`;
}
</script>
</body>
</html>

